<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Endless Runner</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
}
canvas{
  display:block;
  background:linear-gradient(#444,#111);
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// Lanes
const lanes = [
  innerWidth/2 - 120,
  innerWidth/2,
  innerWidth/2 + 120
];
let lane = 1;

// Player
let player = {
  x: lanes[lane],
  y: innerHeight - 150,
  w: 40,
  h: 60
};

// Obstacles
let obstacles = [];
let speed = 6;
let score = 0;

// Touch swipe
let startX = 0;
document.addEventListener("touchstart",e=>{
  startX = e.touches[0].clientX;
});
document.addEventListener("touchend",e=>{
  let endX = e.changedTouches[0].clientX;
  if(endX - startX > 50 && lane < 2) lane++;
  if(startX - endX > 50 && lane > 0) lane--;
  player.x = lanes[lane];
});

// Spawn obstacles
setInterval(()=>{
  obstacles.push({
    lane: Math.floor(Math.random()*3),
    y: -60
  });
}, 900);

// Game loop
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Road
  ctx.strokeStyle="#666";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(innerWidth/2-60,0);
  ctx.lineTo(innerWidth/2-60,innerHeight);
  ctx.moveTo(innerWidth/2+60,0);
  ctx.lineTo(innerWidth/2+60,innerHeight);
  ctx.stroke();

  // Player
  ctx.fillStyle="#00f7ff";
  ctx.fillRect(player.x-20,player.y,player.w,player.h);

  // Obstacles
  ctx.fillStyle="red";
  obstacles.forEach((o,i)=>{
    o.y += speed;
    let ox = lanes[o.lane] - 20;
    ctx.fillRect(ox,o.y,40,40);

    // Collision
    if(
      ox < player.x+20 &&
      ox+40 > player.x-20 &&
      o.y < player.y+player.h &&
      o.y+40 > player.y
    ){
      alert("Game Over | Score: "+score);
      location.reload();
    }

    if(o.y > innerHeight){
      obstacles.splice(i,1);
      score++;
    }
  });

  // Score
  ctx.fillStyle="#fff";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,20,30);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>